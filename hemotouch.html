<!DOCTYPE html>
<html>
    <head>
        <script src="hemotouch.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="stylesheet" href="hemotouch_styles.css">
        <title>HEMOTOUCH</title>
    </head>
    <body>
        <div class="header">
            <div class="first-header">
                <div class="header-leftpart">
                    <input class="search-box" type="text" placeholder="Search">
                </div>
                <div class="header-rightpart">
                    <img class="bell-icon" src="/logos/bell-icon.png">
                    <img class="mail-icon"src="/logos/mail-icon.jpg">
                    <img class="user-logo" src="/logos/user-icon.jpg">
                    <div>
                        <label>Aster Medicity</label>
                    </div>
                    <div class="drop-down">
                           
                        <img class="arrow-down" src="/logos/arrow-down.jpg" onclick="toggle_dropdown()">

                        <div class="drop-down-container" id="drop-down-menu">
                            <a href="#">Home</a>
                            <a href="#">About</a>
                            <a href="#">Edit</a>
                            <a href="#">View</a>
                        </div> 
                    </div>
                </div>
            </div>
            
            <div class="second-header">
                <div class="header-buttons">
                    <button class="request-button" onclick="showsection('request'); show_button_bold('request-button');">REQUEST</button>
                    <button class="donate-button" onclick="showsection('donate'); show_button_bold('donate-button');">DONATE</button>
                    <button class="edit-button" onclick="showsection('edit'); show_button_bold('edit-button');">EDIT</button>
                    <button class="appointments-button"  onclick="showsection('appointments'); show_button_bold('appointments-button'); fetchappointmentdata();">APPOINTMENTS</button>
                </div>
            </div>
        </div>
        <div class="sidebar">
            <button class="dashboard-button" onclick="showsection('dashboard'); show_button_bold('dashboard-button');">DASHBOARD</button>
            <button class="view-donors-button"  onclick="showsection('view-donors'); view_donors_table(); show_button_bold('view-donors-button');">VIEW-DONORS</button>
            <button class="view-pending-button"  onclick="showsection('view-pending'); show_button_bold('view-pending-button'); fetchpendingdata();">VIEW-PENDING</button>
            <button class="donors-current-button"  onclick="showsection('donors-current'); donorslist_table(); show_button_bold('donors-current-button');">DONORS-LIST</button>
            <button class="emergency-request-button"  onclick="showsection('emergency-request'); show_button_bold('emergency-request-button');">EMERGENCY-REQUEST</button>
        </div>

        <div class="dashboard active">
            <div class="dashboard-flex1">
            <canvas id="bloodChart" class="blood-chart"></canvas>
            <canvas id="donationChart" class="donation-chart"></canvas>
            </div>
            <div class="dashboard-flex2">
                <table class="blood-compatibility">
                    <tr>
                        <th>Blood Type</th>
                        <th>Can Donate To</th>
                        <th>Can Receive From</th>
                    </tr>
                    <tr><td>A+</td><td>A+, AB+</td><td>A+, A-, O+, O-</td></tr>
                    <tr><td>A-</td><td>A+, A-, AB+, AB-</td><td>A-, O-</td></tr>
                    <tr><td>B+</td><td>B+, AB+</td><td>B+, B-, O+, O-</td></tr>
                    <tr><td>B-</td><td>B+, B-, AB+, AB-</td><td>B-, O-</td></tr>
                    <tr><td>AB+</td><td>AB+</td><td>All Blood Groups</td></tr>
                    <tr><td>AB-</td><td>AB+, AB-</td><td>A-, B-, AB-, O-</td></tr>
                    <tr><td>O+</td><td>O+, A+, B+, AB+</td><td>O+, O-</td></tr>
                    <tr><td>O-</td><td>All Blood Groups</td><td>O-</td></tr>
                </table>
                              
            </div>
        </div>
        <div class="view-donors">
            <div class="filter">
                <button class="sort-button">Sort</button>
                <button class="groupby-button">Group By</button>
                <button class="addnewtask-button">Add new task</button>
            </div>
            <table class="donors-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>AGE</th>
                        <th>BLOOD_GROUP</th>
                        <th>DISEASES</th>
                        <th>PHONE_NO</th>
                        <th>ADDRESS</th>
                        <th>DATE_OF_DONATION</th>
                    </tr>
                </thead>
                <tbody id="donor-table"></tbody>
            </table>
        </div>
        <div class="view-pending">
            <div class="filter">
                <button class="sort-button">Sort</button>
                <button class="groupby-button">Group By</button>
                <button class="addnewtask-button">Add new task</button>
            </div>
            <table class="donors-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>AGE</th>
                        <th>BLOOD_GROUP</th>
                        <th>PHONE_NO</th>
                        <th>ADDRESS</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="pending-table"></tbody>
            </table>
        </div>
        <div class="donors-current">
                <table class="donors-table">
                    <thead>
                        <tr>
                            <th>NAME</th>
                            <th>AGE</th>
                            <th>BLOOD_GROUP</th>
                            <th>DISEASES</th>
                            <th>PHONE_NO</th>
                            <th>ADDRESS</th>
                            <th>HOSPITAL</th>
                            <th>DATE_OF_DONATION</th>
                        </tr>
                    </thead>
                    <tbody id="donors-list"></tbody>
                </table>
        </div>
        <div class="emergency-request">
            <div class="donors-flex1">
                <div class="fingerprint-outerframe">
                    <div class="fingerprint-innerframe"></div>
                </div>
                <div class="result">
                    <p style="width: 100px;">Detected Blood Group</p>
                    <div class="predicted-bgp"><label class="blood-gp">AB+</label></div>
                </div>
            </div>
            <div class="donors-flex2">
                <div class="search-donor-emergency activate" onclick="showsubsection3('emergency-req-donor-details')">
                    <label style="cursor: pointer;">Search for Donors</label>
                </div>
                <div class="emergency-req-donor-details">
                    <img class="prev-page-icon"src="/youtube-icons/prev-page-icon.png" onclick="showsubsection3('search-donor-emergency')">
                    <label style="margin-bottom: 15px; margin-top: 3px;">Patient details</label>
                    <label>Name</label>
                    <input type="text" id="name-req-emer" placeholder="name">
                    <label>Age</label>
                    <input type="text" id="age-req-emer" placeholder="age">
                    <label>Blood Group</label>
                    <select class="bloodgp-dropdown" id="bloodgp-dropdown-req-emergency" onchange="fetchCompatibleBloodGroups_emergency()">
                        <option value="" disabled selected>Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                    <label>Phno</label>
                    <input type="text" id="phno-req-emer" placeholder="Phno">
                    <label>Address</label>
                    <input type="text" id="address-req-emer" placeholder="Address">
                    <button class="reg-submit-button" onclick="submitrequest_emergency()">Submit</button>
                </div>
                <div class="hospital-inventory">
                    <p>Hospital Inventory</p>
                </div>
                <div class="compatible-bgp">
                    <p>Comaptible Blood Groups</p>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                   
                                </th>
                            </tr>
                        <thead>
                        <tbody class="compatible-blood-table-emergency" id="compatible-blood-table-emergency">
                            <tr>
                                <td>A+</td>
                            </tr>
                            <tr>
                                <td>B+</td>
                            </tr>
                            <tr>
                                <td>AB+</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="request">
            <div class="donors-flex1">
                <div class="fingerprint-outerframe">
                    <div class="fingerprint-innerframe"></div>
                </div>
                <div class="result">
                    <p style="width: 100px;">Detected Blood Group</p>
                    <div class="predicted-bgp"><label class="blood-gp">AB+</label></div>
                </div>
            </div>
            <div class="donors-flex2">
                <div class="search-donor activate" onclick="showsubsection2('req-donor-details')">
                    <label style="cursor: pointer;">Search for Donors</label>
                </div>
                <div class="req-donor-details">
                    <img class="prev-page-icon"src="/youtube-icons/prev-page-icon.png" onclick="showsubsection2('search-donor')">
                    <label style="margin-bottom: 15px; margin-top: 3px;">Patient details</label>
                    <label>Name</label>
                    <input type="text" id="name-req" placeholder="name">
                    <label>Age</label>
                    <input type="text" id="age-req" placeholder="age">
                    <label>Blood Group</label>
                    <select class="bloodgp-dropdown" id="bloodgp-dropdown-req" onchange="fetchCompatibleBloodGroups()">
                        <option value="" disabled selected>Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                    <label>Phno</label>
                    <input type="text" id="phno-req" placeholder="Phno">
                    <label>Address</label>
                    <input type="text" id="address-req" placeholder="Address">
                    <button class="reg-submit-button" onclick="submitrequest()">Submit</button>
                </div>
                <div class="hospital-inventory">
                    <p>Hospital Inventory</p>
                    <table>
                        <thead>
                            <tr>
                                <th>BLOOD GROUP</th>
                                <th>QUANTITY</th>
                            </tr>
                        </thead>
                        <tbody id="bloodgp-quantity-table">
                        </tbody>
                    </table>
                </div>
                <div class="compatible-bgp">
                    <p>Comaptible Blood Groups</p>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                   
                                </th>
                            </tr>
                        <thead>
                        <tbody id="compatible-blood-table">
                            <tr>
                                <td>A+</td>
                            </tr>
                            <tr>
                                <td>B+</td>
                            </tr>
                            <tr>
                                <td>AB+</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="donate">
            <div class="donors-flex1">
                <div class="fingerprint-outerframe">
                    <div class="fingerprint-innerframe"></div>
                </div>
                <div class="result">
                    <p style="width: 100px;">Detected Blood Group</p>
                    <div class="predicted-bgp"><label class="blood-gp">AB+</label></div>
                </div>
            </div>
            <div class="donors-flex2">
                <div class="register-donor activate" onclick="showsubsection1('donor-details')">
                    <label style="cursor: pointer;">Register Donor</label>
                </div>
                <div class="donor-details">
                    <img class="prev-page-icon"src="/youtube-icons/prev-page-icon.png" onclick="showsubsection1('register-donor')">
                    <label>Name</label>
                    <input type="text" id="name" placeholder="name">
                    <label>Age</label>
                    <input type="text" id="age" placeholder="age">
                    <label>Blood Group</label>
                    <select class="bloodgp-dropdown" id="bloodgp-dropdown-don" onchange="fetchCompatibleBloodGroups_don()">
                        <option value="" disabled selected>Blood Group</option>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                    <label>Diseases</label>
                    <input type="text" id="diseases" placeholder="disease">
                    <label>Phno</label>
                    <input type="text" id="phno" placeholder="Phno">
                    <label>Address</label>
                    <input type="text" id="address" placeholder="Address">
                    <button class="reg-submit-button" onclick="submitdonor(); submitappointment(); submitdonorslist(); bloodquantity_don();">Make Appointment</button>
                </div>
                <div class="register-success" onclick="showsubsection1('register-donor')">
                    <label  style="cursor: pointer;">Successfully Registerd</label>
                </div>
                <div class="hospital-inventory">
                    <p>Hospital Inventory</p>
                    <table>
                        <thead>
                            <tr>
                                <th>BLOOD GROUP</th>
                                <th>QUANTITY</th>
                            </tr>
                        </thead>
                        <tbody id="bloodgp-quantity-table-don">
                        </tbody>
                    </table>
                </div>
                <div class="compatible-bgp">
                    <p>Comaptible Blood Groups</p>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                   
                                </th>
                            </tr>
                        <thead>
                        <tbody id="compatible-blood-table-donate">
                            <tr>
                                <td>A+</td>
                            </tr>
                            <tr>
                                <td>B+</td>
                            </tr>
                            <tr>
                                <td>AB+</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="edit">
            <div class="edit-container">
                <div>
                    <img src="/logos/img1.webp">
                </div>
                <div>
                    <img src="/logos/img2.png">
                </div>
                <div>
                    <img src="/logos/img3.jpg">
                </div>
                <div>
                    <img src="/logos/img4.avif">
                </div>
                <div>
                    <img src="/logos/img5.png">
                </div>
                <div>
                    <img src="/logos/img6.png">
                </div>
            </div>
        </div>
        <div class="appointments">
            <div class="filter">
                <button class="sort-button">Sort</button>
                <button class="groupby-button">Group By</button>
                <button class="addnewtask-button">Add new task</button>
            </div>
            <table class="donors-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>AGE</th>
                        <th>BLOOD GROUP</th>
                        <th>PHONE NO</th>
                        <th>ADDRESS</th>
                        <th>APPOINTMENT DATE</th>
                        <th> </th>
                    </tr>
                </thead>
                <tbody id="appointment-table"></tbody>
            </table>
        </div>
        <div class="donor-filtered">
            <div class="filter">
                <button class="sort-button">Sort</button>
                <button class="groupby-button">Group By</button>
                <button class="addnewtask-button">Add new task</button>
            </div>
            <table class="donors-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>AGE</th>
                        <th>BLOOD_GROUP</th>
                        <th>DISEASES</th>
                        <th>PHONE_NO</th>
                        <th>ADDRESS</th>
                        <th>DATE_OF_DONATION</th>
                    </tr>
                </thead>
                <tbody id="donor-filtered-table"></tbody>
            </table>
        </div>

        <div class="donor-filtered-emergency">
            <div class="filter">
                <button class="sort-button">Sort</button>
                <button class="groupby-button">Group By</button>
                <button class="addnewtask-button">Add new task</button>
            </div>
            <table class="donors-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>AGE</th>
                        <th>BLOOD_GROUP</th>
                        <th>DISEASES</th>
                        <th>PHONE_NO</th>
                        <th>ADDRESS</th>
                        <th>HOSPITAL</th>
                        <th>DATE_OF_DONATION</th>
                    </tr>
                </thead>
                <tbody id="donor-filtered-table-emergency"></tbody>
            </table>
        </div>

    <script>


loadBloodChart();


const ctx = document.getElementById("donationChart").getContext("2d");
    new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug"],
            datasets: [{
                label: "Donations per Month",
                data: [35, 42, 30, 55, 60, 48, 75, 90],
                backgroundColor: ["#FF6384", "#36A2EB", "#FFCE56", "#4CAF50", "#8E44AD", "#E74C3C", "#2C3E50", "#F39C12"]
            }]
        },
        options: {
            responsive: false,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
        }
    });






        function show_button_bold(selectedbutton){
            document.querySelector('.dashboard-button').classList.remove('bold','button-size');
            document.querySelector('.view-donors-button').classList.remove('bold','button-size');
            document.querySelector('.view-pending-button').classList.remove('bold','button-size');
            document.querySelector('.donors-current-button').classList.remove('bold','button-size');
            document.querySelector('.emergency-request-button').classList.remove('bold','button-size');

            document.querySelector('.request-button').classList.remove('bold','button-size');
            document.querySelector('.donate-button').classList.remove('bold','button-size');
            document.querySelector('.edit-button').classList.remove('bold','button-size');
            document.querySelector('.appointments-button').classList.remove('bold','button-size');



        document.querySelector('.'+selectedbutton).classList.add('bold','button-size');

        }
        



            function showsection(section){
                document.querySelector('.dashboard').classList.remove('active');
                document.querySelector('.view-donors').classList.remove('active');
                document.querySelector('.view-pending').classList.remove('active');
                document.querySelector('.donors-current').classList.remove('active');
                document.querySelector('.emergency-request').classList.remove('active');
                document.querySelector('.donor-filtered').classList.remove('active');
                document.querySelector('.donor-filtered-emergency').classList.remove('active');
                

                document.querySelector('.request').classList.remove('active');
                document.querySelector('.donate').classList.remove('active');
                document.querySelector('.edit').classList.remove('active');
                document.querySelector('.appointments').classList.remove('active');

                document.querySelector('.'+section).classList.add('active');
            }

            function showsubsection1(section){
                document.querySelector('.register-donor').classList.remove('activate');
                document.querySelector('.donor-details').classList.remove('activate');
                document.querySelector('.register-success').classList.remove('activate');

                document.querySelector('.'+section).classList.add('activate');
            }
            
            function showsubsection2(section){
                document.querySelector('.search-donor').classList.remove('activate');
                document.querySelector('.req-donor-details').classList.remove('activate');

                document.querySelector('.'+section).classList.add('activate');
            }

            function showsubsection3(section){
                document.querySelector('.search-donor-emergency').classList.remove('activate');
                document.querySelector('.emergency-req-donor-details').classList.remove('activate');

                document.querySelector('.'+section).classList.add('activate');
            }

  //store donor details to db
  async function submitdonor() {
  const name = document.getElementById("name").value;
  const age = document.getElementById("age").value;
  const bloodgp = document.getElementById("bloodgp-dropdown-don").value;
  const diseases = document.getElementById("diseases").value;
  const phno = document.getElementById("phno").value;
  const address = document.getElementById("address").value;

  const donorData = { name, age, bloodgp, diseases, phno, address };

  try {
    const response = await fetch("http://localhost:3000/donors", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(donorData),
    });

    const result = await response.json();

    if (result.success) {
      //alert("Donor added successfully!");
      // Clear input fields
      document.getElementById("name").value = "";
      document.getElementById("age").value = "";
      document.getElementById("bloodgp-dropdown-don").value = "";
      document.getElementById("diseases").value = "";
      document.getElementById("phno").value = "";
      document.getElementById("address").value = "";

      showsubsection1("register-success");
    } else {
      alert("Error adding donor!");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong!");
  }
}


   //store request details to db
  async function submitrequest() {
  const name = document.getElementById("name-req").value;
  const age = document.getElementById("age-req").value;
  const bloodgp = document.getElementById("bloodgp-dropdown-req").value;
  const phno = document.getElementById("phno-req").value;
  const address = document.getElementById("address-req").value;

  const requestData = { name, age, bloodgp, phno, address };

  try {
    const response = await fetch("http://localhost:3000/pending", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(requestData),
    });

    const result = await response.json();

    if (result.success) {
      alert("Donor added successfully!");
      // Clear input fields
      document.getElementById("name-req").value = "";
      document.getElementById("age-req").value = "";
      document.getElementById("bloodgp-dropdown-req").value = "";
      document.getElementById("phno-req").value = "";
      document.getElementById("address-req").value = "";

      //showsubsection1("register-success");
    } else {
      alert("Error adding donor!");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong!");
  }
}

//store emergency req to db
async function submitrequest_emergency() {
  const name = document.getElementById("name-req-emer").value;
  const age = document.getElementById("age-req-emer").value;
  const bloodgp = document.getElementById("bloodgp-dropdown-req-emergency").value;
  const phno = document.getElementById("phno-req-emer").value;
  const address = document.getElementById("address-req-emer").value;

  const requestData = { name, age, bloodgp, phno, address };

  try {
    const response = await fetch("http://localhost:3000/pending/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(requestData),
    });

    const result = await response.json();

    if (result.success) {
      alert("Donor added successfully!");
      // Clear input fields
      document.getElementById("name-req-emer").value = "";
      document.getElementById("age-req-emer").value = "";
      document.getElementById("bloodgp-dropdown-req-emergency").value = "";
      document.getElementById("phno-req-emer").value = "";
      document.getElementById("address-req-emer").value = "";

      //showsubsection1("register-success");
    } else {
      alert("Error adding donor!");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong!");
  }
}



 //store donor details to donorslist-db
 async function submitdonorslist() {
  const name = document.getElementById("name").value;
  const age = document.getElementById("age").value;
  const bloodgp = document.getElementById("bloodgp-dropdown-don").value;
  const diseases = document.getElementById("diseases").value;
  const phno = document.getElementById("phno").value;
  const address = document.getElementById("address").value;

  const donorData = { name, age, bloodgp, diseases, phno, address };

  try {
    const response = await fetch("http://localhost:3000/all/donorslist", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(donorData),
    });

    const result = await response.json();

    if (result.success) {
      //alert("Donor added successfully!");
      // Clear input fields
      /*document.getElementById("name").value = "";
      document.getElementById("age").value = "";
      document.getElementById("bloodgp-dropdown-don").value = "";
      document.getElementById("diseases").value = "";
      document.getElementById("phno").value = "";
      document.getElementById("address").value = "";

      showsubsection1("register-success"); */
    } else {
      alert("Error adding donor!");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong!");
  }
}





            function toggle_dropdown(){
                var dropdown;
                dropdown=document.getElementById('drop-down-menu');

                if(dropdown.style.display== "block"){
                    dropdown.style.display= "none";
                }else{
                    dropdown.style.display= "block";
                }
            }

            document.addEventListener("click",function(event){
                var arrow_down=document.querySelector('.arrow-down');
                var drop_down=document.querySelector('.drop-down-container');

                if(!arrow_down.contains(event.target) && !drop_down.contains(event.target)){
                    drop_down.style.display= "none";
                }
            })

        //fetch view-donors table
        function view_donors_table(){
            const donor_table=document.getElementById('donor-table');
        fetch("http://localhost:3000/donors")
        .then(response => response.json())
        .then(data => {
            data.forEach(donor => {
                const row = `<tr>
                    <td>${donor.name}</td>
                    <td>${donor.age}</td>
                    <td>${donor.bloodgp}</td>
                    <td>${donor.diseases}</td>
                    <td>${donor.phno}</td>
                    <td>${donor.address}</td>
                    <td>${donor.date_of_donation}</td>
                </tr>`;
                donor_table.innerHTML += row;
            });
        })
        .catch(error => console.error("Error fetching data:", error));
        }
        

        //delete pending row
        async function deleteRow(id) {
            if (!confirm("Are you sure you want to delete this row?")) return;

            const response = await fetch(`http://localhost:3000/pending/${id}`, { method: "DELETE" });
            const result = await response.json();
            alert(result.message);

            fetchpendingdata("http://localhost:3000/pending"); // Refresh the table
        }

        // Load data when the page loads
        fetchpendingdata("http://localhost:3000/pending");


        //fetch pending table
        async function fetchpendingdata(){
            const pending_table=document.getElementById('pending-table');
        fetch("http://localhost:3000/pending")
        .then(response => response.json())
        .then(data => {
            pending_table.innerHTML="";
            data.forEach(pending => {
                const row = `<tr>
                    <td>${pending.name}</td>
                    <td>${pending.age}</td>
                    <td>${pending.bloodgp}</td>
                    <td>${pending.phno}</td>
                    <td>${pending.address}</td>
                    <td><button class="pending-delete-button" onclick="deleteRow(${pending.id}); decrementBloodQuantity('${pending.bloodgp}');">Delete</button></td>
                </tr>`;
                pending_table.innerHTML += row;
            });
        })
        .catch(error => console.error("Error fetching data:", error));
        }
        

        //fetch compatible bloodgp-request
        async function fetchCompatibleBloodGroups() {
            const selectedBloodGroup = document.getElementById("bloodgp-dropdown-req").value;
            if (!selectedBloodGroup) return;

            try {
                const response = await fetch(`http://localhost:3000/compatible_bgp/${selectedBloodGroup}`);
                const data = await response.json();

                const tableBody = document.getElementById("compatible-blood-table");
                tableBody.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(bloodGroup => {
                        const row = `<tr><td>${bloodGroup}</td></tr>`;
                        tableBody.innerHTML += row;
                    });
                } else {
                    tableBody.innerHTML = "<tr><td>No data found</td></tr>";
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        //donor-details from compatible bloodgp
        document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("compatible-blood-table");

        table.addEventListener("click", function (event) {
            if (table.contains(event.target)) {
                const selectedBloodGroup = event.target.textContent.trim();

                // Fetch donors from the server
                fetch(`http://localhost:3000/donors/all?bloodgp=${encodeURIComponent(selectedBloodGroup)}`)

                    .then(response => response.json())
                    .then(data => {
                        const donorList = document.getElementById('donor-filtered-table');
                        donorList.innerHTML = ""; // Clear previous results

                        data.forEach(donor => {
                            const row = `<tr>
                                <td>${donor.name}</td>
                                <td>${donor.age}</td>
                                <td>${donor.bloodgp}</td>
                                <td>${donor.diseases}</td>
                                <td>${donor.phno}</td>
                                <td>${donor.address}</td>
                                <td>${donor.date_of_donation}</td>
                                </tr>`;
                                donorList.innerHTML += row;
                        });
                        showsection("donor-filtered");
                    })
                    .catch(error => console.error("Error fetching donors:", error));
            }
        });
    });


    //fetch compatible bloodgp-donate
    async function fetchCompatibleBloodGroups_don() {
            const selectedBloodGroup = document.getElementById("bloodgp-dropdown-don").value;
            if (!selectedBloodGroup) return;

            try {
                const response = await fetch(`http://localhost:3000/compatible_bgp_don/${selectedBloodGroup}`);
                const data = await response.json();

                const tableBody = document.getElementById("compatible-blood-table-donate");
                tableBody.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(bloodGroup => {
                        const row = `<tr><td>${bloodGroup}</td></tr>`;
                        tableBody.innerHTML += row;
                    });
                } else {
                    tableBody.innerHTML = "<tr><td>No data found</td></tr>";
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }


        //fetch compatible bloodgp-request-emergency
        async function fetchCompatibleBloodGroups_emergency() {
            const selectedBloodGroup = document.getElementById("bloodgp-dropdown-req-emergency").value;
            if (!selectedBloodGroup) return;

            try {
                const response = await fetch(`http://localhost:3000/compatible_bgp/all/${selectedBloodGroup}`);
                const data = await response.json();

                const tableBody = document.querySelector(".compatible-blood-table-emergency");
                tableBody.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(bloodGroup => {
                        const row = `<tr><td>${bloodGroup}</td></tr>`;
                        tableBody.innerHTML += row;
                    });
                } else {
                    tableBody.innerHTML = "<tr><td>No data found</td></tr>";
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }




        //fetch donors-list 
        function donorslist_table(){
            const donors_list_table=document.getElementById('donors-list');
        fetch("http://localhost:3000/donorslist")
        .then(response => response.json())
        .then(data => {
            data.forEach(donor => {
                const row = `<tr>
                    <td>${donor.name}</td>
                    <td>${donor.age}</td>
                    <td>${donor.bloodgp}</td>
                    <td>${donor.diseases}</td>
                    <td>${donor.phno}</td>
                    <td>${donor.address}</td>
                    <td>${donor.hospital}</td>
                    <td>${donor.date_of_donation}</td>
                </tr>`;
                donors_list_table.innerHTML += row;
            });
        })
        .catch(error => console.error("Error fetching data:", error));
        }


        //donor-details from compatible bloodgp- emergency request
        document.addEventListener("DOMContentLoaded", function () {
        const table = document.querySelector(".compatible-blood-table-emergency");

        table.addEventListener("click", function (event) {
            if (table.contains(event.target)) {
                const selectedBloodGroup = event.target.textContent.trim();

                // Fetch donors from the server
                fetch(`http://localhost:3000/donorslist/all?bloodgp=${encodeURIComponent(selectedBloodGroup)}`)

                    .then(response => response.json())
                    .then(data => {
                        const donorList = document.getElementById('donor-filtered-table-emergency');
                        donorList.innerHTML = ""; // Clear previous results

                        data.forEach(donor => {
                            const row = `<tr>
                                <td>${donor.name}</td>
                                <td>${donor.age}</td>
                                <td>${donor.bloodgp}</td>
                                <td>${donor.diseases}</td>
                                <td>${donor.phno}</td>
                                <td>${donor.address}</td>
                                <td>${donor.hospital}</td>
                                <td>${donor.date_of_donation}</td>
                                </tr>`;
                                donorList.innerHTML += row;
                        });
                        showsection("donor-filtered-emergency");
                    })
                    .catch(error => console.error("Error fetching donors:", error));
            }
        });
    });


     //store appointment details to db
  async function submitappointment() {
  const name = document.getElementById("name").value;
  const age = document.getElementById("age").value;
  const bloodgp = document.getElementById("bloodgp-dropdown-don").value;
  const phno = document.getElementById("phno").value;
  const address = document.getElementById("address").value;

  const donorData = { name, age, bloodgp, phno, address };

  try {
    const response = await fetch("http://localhost:3000/appointments", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(donorData),
    });

    const result = await response.json();

    if (result.success) {
      //alert("Donor added successfully!");
      // Clear input fields
      //document.getElementById("name").value = "";
      //document.getElementById("age").value = "";
      //document.getElementById("bloodgp-dropdown-don").value = "";
      //document.getElementById("diseases").value = "";
      //document.getElementById("phno").value = "";
      //document.getElementById("address").value = "";

      //showsubsection1("register-success");
    } else {
      alert("Error adding donor!");
    }
  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong!");
  }
}



//delete appointment row
async function deleteappointmentRow(id) {
            if (!confirm("Are you sure you want to delete this row?")) return;

            const response = await fetch(`http://localhost:3000/appointments/${id}`, { method: "DELETE" });
            const result = await response.json();
            alert(result.message);

            fetchappointmentdata("http://localhost:3000/appointments"); // Refresh the table
        }

        // Load data when the page loads
        //fetchpendingdata("http://localhost:3000/pending");


        //fetch appointments table
        async function fetchappointmentdata(){
            const appointment_table=document.getElementById('appointment-table');
        fetch("http://localhost:3000/appointments")
        .then(response => response.json())
        .then(data => {
            appointment_table.innerHTML="";
            data.forEach(appointment => {
                const row = `<tr>
                    <td>${appointment.name}</td>
                    <td>${appointment.age}</td>
                    <td>${appointment.bloodgp}</td>
                    <td>${appointment.phno}</td>
                    <td>${appointment.address}</td>
                    <td>${appointment.appointment_date}</td>
                    <td><button class="pending-delete-button" onclick="deleteappointmentRow(${appointment.id})">Delete</button></td>
                </tr>`;
                appointment_table.innerHTML += row;
            });
        })
        .catch(error => console.error("Error fetching data:", error));
        }



        //blood quantity in hospital inventory-request
        async function loadBloodInventory() {
    try {
        const response = await fetch("http://localhost:3000/api/blood_quantity");
        const data = await response.json();

        const tableBody = document.getElementById("bloodgp-quantity-table");
        tableBody.innerHTML = ""; // Clear existing rows

        data.forEach((item) => {
            const row = `<tr>
                    <td>${item.bloodgp}</td>
                    <td>${item.quantity} Unit</td>
                </tr>`;
                tableBody.innerHTML += row;



            /*const row = document.createElement("tr");
            row.innerHTML = `<td>${item.bloodgp}</td><td>${item.quantity}</td>`;
            tableBody.appendChild(row); */
        });
    } catch (error) {
        console.error("Error fetching blood inventory:", error);
    }
}

// Run function when the page loads
document.addEventListener("DOMContentLoaded", loadBloodInventory);




//blood quantity in hospital inventory-donate
async function loadBloodInventory_don() {
    try {
        const response = await fetch("http://localhost:3000/apii/blood_quantity");
        const data = await response.json();

        const tableBody = document.getElementById("bloodgp-quantity-table-don");
        tableBody.innerHTML = ""; // Clear existing rows

        data.forEach((item) => {
            const row = `<tr>
                    <td>${item.bloodgp}</td>
                    <td>${item.quantity} Unit</td>
                </tr>`;
                tableBody.innerHTML += row;
        });
    } catch (error) {
        console.error("Error fetching blood inventory:", error);
    }
}

// Run function when the page loads
document.addEventListener("DOMContentLoaded", loadBloodInventory_don);



//update blood_quantity when donate
function bloodquantity_don() {
    const bloodgp = document.getElementById('bloodgp-dropdown-don').value;

    if (!bloodgp) {
        alert('Please select a blood group.');
        return;
    }

    fetch('http://localhost:3000/blood_quantity', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ bloodgp }),
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        loadBloodInventory();
        loadBloodInventory_don();
    })
    .catch(error => console.error('Error:', error));
}



//update blood quantity-decrement
function decrementBloodQuantity(bloodgp) {
    fetch('http://localhost:3000/all/blood_quantity', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ bloodgp })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
        loadBloodInventory();
        loadBloodInventory_don();
    })
    .catch(error => console.error('Error:', error));
}




async function loadBloodChart() {
        try {
            const response = await fetch("http://localhost:3000/apiii/blood_quantity"); 
            const data = await response.json();

            const bloodGroups = data.map(item => item.bloodgp);  // Blood group names
            const quantities = data.map(item => item.quantity);  // Blood group quantities

            const ctx = document.getElementById("bloodChart").getContext("2d");
            new Chart(ctx, {
                type: "pie",
                data: {
                    labels: bloodGroups,
                    datasets: [{
                        data: quantities,
                        backgroundColor: [
                            "#FF6384", "#36A2EB", "#FFCE56", 
                            "#4CAF50", "#8E44AD", "#E74C3C", 
                            "#2C3E50", "#F39C12"
                        ]
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: "top"
                        }
                    }
                }
            });
        } catch (error) {
            console.error("Error loading chart:", error);
        }
    }



    </script>
        
    </body>
</html> 